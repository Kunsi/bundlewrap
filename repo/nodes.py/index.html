<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>nodes.py - BundleWrap</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../bundlewrap.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-33891245-2', 'docs.bundlewrap.org');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">BundleWrap</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../.."><i class="fa fa-home"></i></a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../guide/quickstart/">Quickstart</a>
</li>
                                    
<li >
    <a href="../../guide/installation/">Installation</a>
</li>
                                    
<li >
    <a href="../../guide/cli/">CLI</a>
</li>
                                    
<li >
    <a href="../../guide/env/">Environment Variables</a>
</li>
                                    
<li >
    <a href="../../guide/item_file_templates/">File templates</a>
</li>
                                    
<li >
    <a href="../../guide/secrets/">Handling secrets</a>
</li>
                                    
<li >
    <a href="../../guide/locks/">Locking</a>
</li>
                                    
<li >
    <a href="../../guide/kubernetes/">Kubernetes</a>
</li>
                                    
<li >
    <a href="../../guide/dev_item/">Custom items</a>
</li>
                                    
<li >
    <a href="../../guide/dev_plugin/">Writing plugins</a>
</li>
                                    
<li >
    <a href="../../guide/api/">Python API</a>
</li>
                                    
<li >
    <a href="../../guide/os_compatibility/">OS compatibility</a>
</li>
                                    
<li >
    <a href="../../guide/migrate_12/">Migrating to 2.0</a>
</li>
                                    
<li >
    <a href="../../guide/migrate_23/">Migrating to 3.0</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../layout/">Overview</a>
</li>
                                    
<li class="active">
    <a href="./">nodes.py</a>
</li>
                                    
<li >
    <a href="../groups.py/">groups.py</a>
</li>
                                    
<li >
    <a href="../requirements.txt/">requirements.txt</a>
</li>
                                    
<li >
    <a href="../items.py/">bundles/.../items.py</a>
</li>
                                    
<li >
    <a href="../metadata.py/">bundles/.../metadata.py</a>
</li>
                                    
<li >
    <a href="../hooks/">hooks/</a>
</li>
                                    
<li >
    <a href="../libs/">libs/</a>
</li>
                                    
<li >
    <a href="../plugins/">Plugins</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Items <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../items/action/">action</a>
</li>
                                    
<li >
    <a href="../../items/directory/">directory</a>
</li>
                                    
<li >
    <a href="../../items/file/">file</a>
</li>
                                    
<li >
    <a href="../../items/group/">group</a>
</li>
                                    
<li >
    <a href="../../items/k8s/">k8s_*</a>
</li>
                                    
<li >
    <a href="../../items/pkg_apt/">pkg_apt</a>
</li>
                                    
<li >
    <a href="../../items/pkg_dnf/">pkg_dnf</a>
</li>
                                    
<li >
    <a href="../../items/pkg_openbsd/">pkg_openbsd</a>
</li>
                                    
<li >
    <a href="../../items/pkg_opkg/">pkg_opkg</a>
</li>
                                    
<li >
    <a href="../../items/pkg_pacman/">pkg_pacman</a>
</li>
                                    
<li >
    <a href="../../items/pkg_pip/">pkg_pip</a>
</li>
                                    
<li >
    <a href="../../items/pkg_snap/">pkg_snap</a>
</li>
                                    
<li >
    <a href="../../items/pkg_yum/">pkg_yum</a>
</li>
                                    
<li >
    <a href="../../items/pkg_zypper/">pkg_zypper</a>
</li>
                                    
<li >
    <a href="../../items/postgres_db/">postgres_db</a>
</li>
                                    
<li >
    <a href="../../items/postgres_role/">postgres_role</a>
</li>
                                    
<li >
    <a href="../../items/svc_openbsd/">svc_openbsd</a>
</li>
                                    
<li >
    <a href="../../items/svc_systemd/">svc_systemd</a>
</li>
                                    
<li >
    <a href="../../items/svc_systemv/">svc_systemv</a>
</li>
                                    
<li >
    <a href="../../items/svc_upstart/">svc_upstart</a>
</li>
                                    
<li >
    <a href="../../items/symlink/">symlink</a>
</li>
                                    
<li >
    <a href="../../items/user/">user</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../misc/about/">About</a>
</li>
                                    
<li >
    <a href="../../misc/deciding/">Why BundleWrap</a>
</li>
                                    
<li >
    <a href="../../misc/glossary/">Glossary</a>
</li>
                                    
<li >
    <a href="../../misc/faq/">FAQ</a>
</li>
                                    
<li >
    <a href="../../misc/contributing/">Contributing</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../layout/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../groups.py/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/bundlewrap/bundlewrap/edit/master/docs/repo/nodes.py.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#nodespy">nodes.py</a></li>
        <li class="main "><a href="#dynamic-node-list">Dynamic node list</a></li>
        <li class="main "><a href="#one-file-per-node">One file per node</a></li>
        <li class="main "><a href="#node-attribute-reference">Node attribute reference</a></li>
            <li><a href="#regular-attributes">Regular attributes</a></li>
            <li><a href="#os-compatibility-overrides">OS compatibility overrides</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="nodespy">nodes.py</h1>
<p>This file lets you specify or dynamically build a list of nodes in your environment.</p>
<p>All you have to do here is define a Python dictionary called <code>nodes</code>. It should look something like this:</p>
<pre><code>nodes = {
    "node-1": {
        'hostname': "node-1.example.com",
    },
}
</code></pre>
<p>With BundleWrap, the DNS name and the internal identifier for a node ("node-1" in this case) are two separate things.</p>
<p>All fields for a node (including <code>hostname</code>) are optional. If you don't give one, BundleWrap will attempt to use the internal identifier to connect to a node:</p>
<pre><code>nodes = {
    "node-1.example.com": {},
}
</code></pre>
<p><br></p>
<h1 id="dynamic-node-list">Dynamic node list</h1>
<p>You are not confined to the static way of defining a node list as shown above. You can also assemble the <code>nodes</code> dictionary dynamically:</p>
<pre><code>def get_my_nodes_from_ldap():
    [...]
    return ldap_nodes

nodes = get_my_nodes_from_ldap()
</code></pre>
<p><br></p>
<h1 id="one-file-per-node">One file per node</h1>
<p>Especially in larger installations, a single nodes.py can become inconvenient to work with. This example reads nodes from a <code>nodes/</code> directory.</p>
<pre><code>from glob import glob
from os.path import join

nodes = {}
for node in glob(join(repo_path, "nodes", "*.py")):
    with open(node, 'r') as f:
        exec(f.read())
</code></pre>
<p>Node files would then append <code>nodes</code>, like this:</p>
<pre><code># nodes/node-1.py
nodes['node-1'] = {
    'hostname': "node-1.example.com",
}
</code></pre>
<p><br></p>
<h1 id="node-attribute-reference">Node attribute reference</h1>
<p>This section is a reference for all possible attributes you can define for a node:</p>
<pre><code>nodes = {
    'node-1': {
        # THIS PART IS EXPLAINED HERE
    },
}
</code></pre>
<p>All attributes can also be set at the group level, unless noted otherwise.</p>
<p><br></p>
<h2 id="regular-attributes">Regular attributes</h2>
<h3 id="bundles">bundles</h3>
<p>A list of bundle names to be assigned to this node. Bundles set at <a href="../groups.py/">group level</a> will be added.</p>
<p><br></p>
<h3 id="dummy">dummy</h3>
<p>Set this to <code>True</code> to prevent BundleWrap from creating items for and connecting to this node. This is useful for unmanaged nodes because you can still assign them bundles and metadata like regular nodes and access that from managed nodes (e.g. for monitoring).</p>
<p><br></p>
<h3 id="hostname">hostname</h3>
<p>A string used as a DNS name when connecting to this node. May also be an IP address.</p>
<div class="alert alert-info">The username and SSH private key for connecting to the node cannot be configured in BundleWrap. If you need to customize those, BundleWrap will honor your <code>~/.ssh/config</code>.</div>

<p>Cannot be set at group level.</p>
<p><br></p>
<h3 id="metadata">metadata</h3>
<p>This can be a dictionary of arbitrary data (some type restrictions apply). You can access it from your templates as <code>node.metadata</code>. Use this to attach custom data (such as a list of IP addresses that should be configured on the target node) to the node. Note that you can also define metadata at the <a href="../groups.py/#metadata">group level</a>, but node metadata has higher priority.</p>
<p>You are restricted to using only the following types in metadata:</p>
<ul>
<li><code>dict</code></li>
<li><code>list</code></li>
<li><code>tuple</code></li>
<li><code>set</code></li>
<li><code>bool</code></li>
<li><code>text</code> / <code>unicode</code></li>
<li><code>bytes</code> / <code>str</code> (only if decodable into text using UTF-8)</li>
<li><code>int</code></li>
<li><code>None</code></li>
<li><code>bundlewrap.utils.Fault</code></li>
</ul>
<div class="alert alert-info">Also see the <a href="../groups.py#metadata">documentation for group.metadata</a> for more information.</div>

<p><br></p>
<h3 id="os">os</h3>
<p>Defaults to <code>"linux"</code>.</p>
<p>A list of supported OSes can be obtained with <code>bw debug -n ANY_NODE_NAME -c "print(node.OS_KNOWN)"</code>.</p>
<p><br></p>
<h3 id="os_version">os_version</h3>
<p>Set this to your OS version. Note that it must be a tuple of integers, e.g. if you're running Ubuntu 16.04 LTS, it should be <code>(16, 4)</code>.</p>
<p>Tuples of integers can be used for easy comparison of versions: <code>(12, 4) &lt; (16, 4)</code></p>
<p><br></p>
<h3 id="template_node">template_node</h3>
<p>Copy all attributes and merge all metadata from this node. This is useful for temporary clones of single specific nodes, where you don't want to create a group to deduplicate all the node-level configuration.</p>
<p>Cannot be set at group level.</p>
<p><br></p>
<h2 id="os-compatibility-overrides">OS compatibility overrides</h2>
<h3 id="cmd_wrapper_outer">cmd_wrapper_outer</h3>
<p>Used whenever a command needs to be run on a node. Defaults to <code>"sudo sh -c {}"</code>. <code>{}</code> will be replaced by the quoted command to be run (after <code>cmd_wrapper_inner</code> has been applied).</p>
<p>You will need to override this if you're not using <code>sudo</code> to gain root privileges (e.g. <code>doas</code>) on the node.</p>
<p><br></p>
<h3 id="cmd_wrapper_inner">cmd_wrapper_inner</h3>
<p>Used whenever a command needs to be run on a node. Defaults to <code>"export LANG=C; {}"</code>. <code>{}</code> will be replaced by the command to be run.</p>
<p>You will need to override this if the shell on your node sets environment variables differently.</p>
<p><br></p>
<h3 id="use_shadow_passwords">use_shadow_passwords</h3>
<div class="alert alert-warning">Changing this setting will affect the security of the target system. Only do this for legacy systems that don't support shadow passwords.</div>

<p>This setting will affect how the <a href="../../items/user/">user item</a> item operates. If set to <code>False</code>, password hashes will be written directly to <code>/etc/passwd</code> and thus be accessible to any user on the system. If the OS of the node is set to "openbsd", this setting has no effect as <code>master.shadow</code> is always used.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>BundleWrap is published under the <a href='https://github.com/bundlewrap/bundlewrap/blob/master/LICENSE'>GPL license</a>.</p><p> Donations welcome in Bitcoin <code>13AJYksqncZromPF8HvDUXsmHChAm3Y7W7</code> or Ethereum <code>0x5Eb3037e197d3C0d2E014bcfC2e027EB0AD42812</code>.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
