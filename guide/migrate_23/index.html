<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Migrating to 3.0 - BundleWrap</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../bundlewrap.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-33891245-2', 'docs.bundlewrap.org');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">BundleWrap</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../.."><i class="fa fa-home"></i></a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../quickstart/">Quickstart</a>
</li>
                                    
<li >
    <a href="../installation/">Installation</a>
</li>
                                    
<li >
    <a href="../cli/">CLI</a>
</li>
                                    
<li >
    <a href="../env/">Environment Variables</a>
</li>
                                    
<li >
    <a href="../item_file_templates/">File templates</a>
</li>
                                    
<li >
    <a href="../secrets/">Handling secrets</a>
</li>
                                    
<li >
    <a href="../locks/">Locking</a>
</li>
                                    
<li >
    <a href="../kubernetes/">Kubernetes</a>
</li>
                                    
<li >
    <a href="../dev_item/">Custom items</a>
</li>
                                    
<li >
    <a href="../dev_plugin/">Writing plugins</a>
</li>
                                    
<li >
    <a href="../api/">Python API</a>
</li>
                                    
<li >
    <a href="../os_compatibility/">OS compatibility</a>
</li>
                                    
<li >
    <a href="../migrate_12/">Migrating to 2.0</a>
</li>
                                    
<li class="active">
    <a href="./">Migrating to 3.0</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../repo/layout/">Overview</a>
</li>
                                    
<li >
    <a href="../../repo/nodes.py/">nodes.py</a>
</li>
                                    
<li >
    <a href="../../repo/groups.py/">groups.py</a>
</li>
                                    
<li >
    <a href="../../repo/requirements.txt/">requirements.txt</a>
</li>
                                    
<li >
    <a href="../../repo/items.py/">bundles/.../items.py</a>
</li>
                                    
<li >
    <a href="../../repo/metadata.py/">bundles/.../metadata.py</a>
</li>
                                    
<li >
    <a href="../../repo/hooks/">hooks/</a>
</li>
                                    
<li >
    <a href="../../repo/libs/">libs/</a>
</li>
                                    
<li >
    <a href="../../repo/plugins/">Plugins</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Items <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../items/action/">action</a>
</li>
                                    
<li >
    <a href="../../items/directory/">directory</a>
</li>
                                    
<li >
    <a href="../../items/file/">file</a>
</li>
                                    
<li >
    <a href="../../items/group/">group</a>
</li>
                                    
<li >
    <a href="../../items/k8s/">k8s_*</a>
</li>
                                    
<li >
    <a href="../../items/pkg_apt/">pkg_apt</a>
</li>
                                    
<li >
    <a href="../../items/pkg_dnf/">pkg_dnf</a>
</li>
                                    
<li >
    <a href="../../items/pkg_openbsd/">pkg_openbsd</a>
</li>
                                    
<li >
    <a href="../../items/pkg_opkg/">pkg_opkg</a>
</li>
                                    
<li >
    <a href="../../items/pkg_pacman/">pkg_pacman</a>
</li>
                                    
<li >
    <a href="../../items/pkg_pip/">pkg_pip</a>
</li>
                                    
<li >
    <a href="../../items/pkg_snap/">pkg_snap</a>
</li>
                                    
<li >
    <a href="../../items/pkg_yum/">pkg_yum</a>
</li>
                                    
<li >
    <a href="../../items/pkg_zypper/">pkg_zypper</a>
</li>
                                    
<li >
    <a href="../../items/postgres_db/">postgres_db</a>
</li>
                                    
<li >
    <a href="../../items/postgres_role/">postgres_role</a>
</li>
                                    
<li >
    <a href="../../items/svc_openbsd/">svc_openbsd</a>
</li>
                                    
<li >
    <a href="../../items/svc_systemd/">svc_systemd</a>
</li>
                                    
<li >
    <a href="../../items/svc_systemv/">svc_systemv</a>
</li>
                                    
<li >
    <a href="../../items/svc_upstart/">svc_upstart</a>
</li>
                                    
<li >
    <a href="../../items/symlink/">symlink</a>
</li>
                                    
<li >
    <a href="../../items/user/">user</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../misc/about/">About</a>
</li>
                                    
<li >
    <a href="../../misc/deciding/">Why BundleWrap</a>
</li>
                                    
<li >
    <a href="../../misc/glossary/">Glossary</a>
</li>
                                    
<li >
    <a href="../../misc/faq/">FAQ</a>
</li>
                                    
<li >
    <a href="../../misc/contributing/">Contributing</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../migrate_12/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../../repo/layout/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/bundlewrap/bundlewrap/edit/master/docs/guide/migrate_23.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#migrating-from-bundlewrap-2x-to-3x">Migrating from BundleWrap 2.x to 3.x</a></li>
            <li><a href="#metadatapy">metadata.py</a></li>
            <li><a href="#file-and-directory-ownership-defaults">File and directory ownership defaults</a></li>
            <li><a href="#systemd-services-enabled-by-default">systemd services enabled by default</a></li>
            <li><a href="#environment-variables">Environment variables</a></li>
            <li><a href="#itemdisplay_keys-and-itemdisplay_dicts">Item.display_keys and Item.display_dicts</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="migrating-from-bundlewrap-2x-to-3x">Migrating from BundleWrap 2.x to 3.x</h1>
<p>As per <a href="http://semver.org">semver</a>, BundleWrap 3.0 breaks compatibility with repositories created for BundleWrap 2.x. This document provides a guide on how to upgrade your repositories to BundleWrap 3.x. Please read the entire document before proceeding.</p>
<p><br></p>
<h2 id="metadatapy">metadata.py</h2>
<p>BundleWrap 2.x simply used all functions in <code>metadata.py</code> whose names don't start with an underscore as metadata processors. This led to awkward imports like <code>from foo import bar as _bar</code>. BundleWrap 3.x requires a decorator for explicitly designating functions as metadata processors:</p>
<pre><code>@metadata_processor
def myproc(metadata):
    return metadata, DONE
</code></pre>
<p>You will have to add <code>@metadata_processor</code> to each metadata processor function. There is no need to import it; it is provided automatically, just like <code>node</code> and <code>repo</code>.</p>
<p>The accepted return values of metadata processors have changed as well. Metadata processors now always have to return a tuple with the first element being a dictionary of metadata and the remaining elements made up of various options to tell BundleWrap what to do with the dictionary. In most cases, you will want to return the <code>DONE</code> options as in the example above. There is no need to import options, they're always available.</p>
<p>When you previously returned <code>metadata, False</code> from a metadata processor, you will now have to return <code>metadata, RUN_ME_AGAIN</code>. For a more detailed description of the available options, see <a href="../../repo/metadata.py/">the documentation</a>.</p>
<p><br></p>
<h2 id="file-and-directory-ownership-defaults">File and directory ownership defaults</h2>
<p><a href="../../items/file/">Files</a>, <a href="../../items/directory/">directories</a>, and <a href="../../items/symlink/">symlinks</a> now have default values for the ownership and mode attributes. Previously the default was to ignore them. It's very likely that you won't have to do anything here, just be aware.</p>
<p><br></p>
<h2 id="systemd-services-enabled-by-default">systemd services enabled by default</h2>
<p>Again, just be <a href="../../items/svc_systemd/">aware</a>, it's probably what you intended anyway.</p>
<p><br></p>
<h2 id="environment-variables">Environment variables</h2>
<p>The following <a href="../env/">env vars</a> have been renamed (though the new names have already been available for a while, so chances are you're already using them):</p>
<table>
<tr><th>Old</th><th>New</th></tr>
<tr><td><code>BWADDHOSTKEYS</code></td><td><code>BW_ADD_HOST_KEYS</code></td></tr>
<tr><td><code>BWCOLORS</code></td><td><code>BW_COLORS</code></td></tr>
<tr><td><code>BWITEMWORKERS</code></td><td><code>BW_ITEM_WORKERS</code></td></tr>
<tr><td><code>BWNODEWORKERS</code></td><td><code>BW_NODE_WORKERS</code></td></tr>
</table>

<p><br></p>
<h2 id="itemdisplay_keys-and-itemdisplay_dicts">Item.display_keys and Item.display_dicts</h2>
<p>If you've written your own items and used the <code>display_keys()</code> or <code>display_dicts()</code> methods or the <code>BLOCK_CONCURRENT</code> attribute, you will have to update them to the <a href="../dev_item/">new API</a>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>BundleWrap is published under the <a href='https://github.com/bundlewrap/bundlewrap/blob/master/LICENSE'>GPL license</a>.</p><p> Donations welcome in Bitcoin <code>13AJYksqncZromPF8HvDUXsmHChAm3Y7W7</code> or Ethereum <code>0x5Eb3037e197d3C0d2E014bcfC2e027EB0AD42812</code>.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
